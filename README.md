# 공급망 최적화 모델 요약 보고서

# SmartPhone Global Supply-Chain Challenge



## 1단계 (Phase 1)

탐색적 데이터 분석(EDA) 기반의 피처 엔지니어링과 이종 모델을 결합한 앙상블 기법을 활용하여 2023년부터 2024년까지의 일별 · SKU별 · 도시별 수요를 정밀하게 예측



## 2단계 (Phase 2)

공급망 최적화는 생산, 재고, 운송 등 다양한 제약조건을 만족시키면서 비용을 최소화하기 위해 Chunked Rolling Horizon MILP를 통해 결과 도출



---



# Phase 1



## 1. 알고리즘 채택 배경 및 모델 설계 과정



본 프로젝트의 수요 예측(Phase 1) 단계는 단순히 단일 모델을 사용하는 것을 넘어, 심층적인 데이터 분석(EDA)을 통해 얻은 인사이트를 모델의 피처와 구조에 적극적으로 반영하는 전략을 채택. 이는 과거 수요뿐만 아니라 유가, 환율, 날씨 등 외부 요인과 신제품 출시 등 내부 요인에 의한 수요 변동의 복잡성을 해결하기 위함.



* **이벤트 탐색 및 정량화**: 신제품 프로모션으로 인해 비정상적인 수요 급증이 발생하는데, 일반적인 시계열 모델은 이런 갑작스러운 변화를 잘 예측하지 못함. 이를 해결하기 위해 통계적 기법(**Z-score**)을 사용해 이벤트를 탐색하고 피처화하여 모델의 정확도를 크게 향상.

* **앙상블 모델**: 복잡한 비선형 관계 포착에 용이한 **RandomForest**, **Gradient Boosting**과 선형 추세 분석에 강점이 있는 **Linear Regression** 모델을 병렬적으로 학습.

* **동적 가중치**: 각 모델의 검증 성능(RMSE)에 반비례하는 **동적 가중치**를 부여하여 단일 모델의 한계를 상호 보완하고 예측 안정성을 극대화.

* **사후 처리**: 최종적으로 EDA에서 발견된 이벤트 패턴을 적용하여 예측값을 보정하는 단계를 거침.



### 2.2 주요 예측 변수(피처) 설계



모델은 원시 데이터에 내재된 정보 가치를 극대화하도록 정교하게 설계된 Feature Engineering을 거친 후, 다음과 같이 다차원적 피처를 구성하여 학습 데이터로 사용.



* **시계열 내재 변수**: 과거 패턴을 학습시키기 위한 **Lag Feature**와 최근 수요의 추세 및 변동성을 나타내는 **Rolling Feature**를 포함.

* **시간 기반 변수**: 요일, 월, 분기 등 시간의 흐름에 따른 주기성과 계절성을 모델링하기 위해 삼각함수를 이용한 **Sin/Cos 변환**을 적용.

* **외부 환경 변수**: 거시 경제 지표(유가, 국가별 환율, 소비자신뢰지수), 지역별 환경 요인(평균 기온, 습도), 마케팅 활동(마케팅 지출액) 등을 포함.

* **제품 및 가격 변수**: 제품 출시 후 경과일, 제품군(Family), 일별 단가(Unit Price) 및 할인율(Discount Rate) 등을 반영.

* **이벤트 변수**: Z-score를 통해 탐지된 수요 급증 이벤트의 발생 여부와 당시의 평균 수요 대비 증가 배수를 직접적인 변수로 활용.



### 2.3 수요 예측 모델 비교 분석



본 프로젝트에서 채택한 '피처 엔지니어링 + 가중 앙상블' 접근법은 다음과 같은 대안적 접근법들과 비교하여 강점을 가짐.



* **전통적 시계열 모델 (e.g., ARIMA, SARIMA)**: 단일 변수 예측에 효과적이지만, 다양한 외부 변수와의 비선형 관계나 비정규적 이벤트를 반영하는 데 한계가 있음.

* **딥러닝 시계열 모델 (e.g., LSTM, GRU)**: 데이터의 장기 의존성을 학습하는 데 강력하지만, 일반적으로 대규모의 학습 데이터와 높은 컴퓨팅 자원이 필요하며, 피처 엔지니어링이 잘 된 경우에는 트리 기반 앙상블 모델이 더 효율적일 수 있음.



---



# Phase 2



## 1. 목적식

목표:  

USD 기준 총비용 + 환경부담금 최소화  



총비용 구성:

- 생산비용

- 운송비용

- 재고 보관비용

- 부족 패널티

- 설비 건설비

- 운송 모드 변경 수수료



---



## 2. 제약식 요약



### 2-1. 서비스 수준

- Fill-Rate 95% 이상 유지



### 2-2. 시설

- 공장 최대 5곳, 창고 최대 20곳

- 동일 도시에 공장·창고 각각 1곳만 설치 가능

- 공장에는 재고 불가

- 공장: 착공 다음 월요일 00시부터 가동, 폐쇄 불가

- 창고: 착공 즉시 완공

- 초기 상태: 모든 창고-SKU 재고 2,000 unit



### 2-3. 생산

- 주별 정규·초과 근무 한도 초과 불가

- SKU별 노동시간 × 생산량 ≤ 주당 최대 근로시간

- 1일 8시간 초과 생산분 → 초과근무 임금 적용

- 기계 고장 기간 중 해당 공장 모든 작업 정지



### 2-4. 재고·유효기간

- 해당 도시에 창고가 있으면 운송비용 없이 수요 소화

- 유효기간(life_days) 경과 재고는 반드시 폐기



### 2-5. 운송

- 허용 경로: 공장→창고, 창고→도시 (창고→창고 불가)

- 동일 국가: 트럭만 허용

- 국가 간: 배 또는 비행기

- 컨테이너 용량: 4,000 unit (부분 적재 허용, 비용 1컨테이너 기준)

- 1회 운송에 복수 모드 혼합 불가

- 국경 통과: 4,000 USD (DEU↔FRA 면제)

- 악천후 시 운송비 ×3 (출발 당일 기준)

- 유가 전주 대비 +5% 이상 상승 시 해당 주 운송비 ×2

- "구간-요일-모드" 4주 고정, 변경 시 직전 4주 운송비의 5% 수수료

- 동일 구간·요일에 모드 분할 운송 금지



### 2-6. 환경부담금

- 생산 CO₂ = carbon_factor_prod × 생산량

- 운송 CO₂ = 거리 × 모드별 CO₂계수 × 컨테이너 수

- 합산 후 200 USD/ton 부과  

  (올림 계산, 1ton 미만도 1ton 적용)



---



## 3. 구현 방식



### Chunked Rolling Horizon MILP

1. 기간 분할 (31일 단위)  

   - 전체 기간을 최대 31일(약 1개월) 길이의 청크(chunk)로 나눔  

   - 각 청크별로 날짜·SKU·도시별 생산·운송·재고 의사결정 수행  

   - 청크 간 연속성 유지를 위해 다음 데이터 전달:

     1. 이전 청크 종료 시점 재고 (창고-SKU별)

     2. 이전 청크에서 출발했으나 도착하지 않은 운송 물량 (리드타임 반영)



2. 순차 최적화

   - 각 청크는 독립적으로 풀지만, 초기 상태를 이어받아 전 기간 연속성 확보

   - Fill-Rate, 생산·운송·재고 제약 유지

   - 계산 복잡도 O(N×기간) → O(N×청크)로 축소



---



## 4. 문제 축소·간소화 기법



### 4-1. Arc Pruning (네트워크 축소)



필요성  

- 공장 후보지 × 창고 후보지 + 창고 후보지 × 도시 수  

- 각 날짜 × 운송 모드 × SKU 조합까지 고려 시 변수(Y, Q) 기하급수적 증가  

- 예: 80개 도시(공장·창고 후보) × 40개 도시(수요지) × 3모드 × 2년치 날짜 = 수백만 Arc  

→ 변수·제약 수 과도 → 연산 불가능



핵심 아이디어  

- 선택 가능성이 낮은 비효율 Arc를 사전 제거  

- 본 구현은 On-the-fly Filtering 방식 적용:

  - 모든 Arc를 미리 만들고 제거하는 대신, 모델 빌드 시 조건을 만족하지 않는 Arc는 생성하지 않음



필터 조건

1. 리드타임 기반  

   - Arc 출발일 + 리드타임이 청크 내 도착일 범위에 없으면 제외

2. 유통기한 기반  

   - 도착 시점이 SKU의 유효 기간 초과 시 제외

3. 네트워크 연결성 기반  

   - (i,k) in IK 또는 (k,j) in KJ 조건만 허용  

   - 창고→창고, 금지 모드 등은 생성 안 함



---



### 4-2. 제약 완화

- Fill-Rate → 주간 합 기준 + Slack (패널티 부과)

- 일부 이진 제약 (예: 모드 변경) → Relaxation 처리
